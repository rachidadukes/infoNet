using System;
using System.Net.Http;
using System.Net.Http.Headers;
using System.Text;
using System.Text.Json;
using System.Threading.Tasks;

// Define classes to map the response JSON
public class NECUResponseHeader
{
    public Status Status { get; set; }
}

public class Status
{
    public string severity { get; set; }
    public string statusDesc { get; set; }
    public string statusCode { get; set; }
}

public class Note
{
    public string messageText { get; set; }
    public string notesExpireDate { get; set; }
    public string notesEntryDateTime { get; set; }
    public string messageId { get; set; }
    public string employeeId { get; set; }
}

public class ResponseData
{
    public NECUResponseHeader NECUResponseHeader { get; set; }
    public string csUID { get; set; }
    public string consumingApplicationName { get; set; }
    public string consumerChannel { get; set; }
    public Note[] notes { get; set; }
    public string btsStatusCode { get; set; }
    public string accountType { get; set; }
    public string btsStatusMessage { get; set; }
    public string accountNumber { get; set; }
}

class Program
{
    private static readonly HttpClient client = new HttpClient();

    static async Task Main(string[] args)
    {
        // API URL
        var apiUrl = "https://unit-dpa-01-plt0.nfcutest.net:5508/NFCUBranchTellerServices/rest/member-account-notes/v1/members/accounts/notes";

        // JSON request body
        var requestData = new
        {
            rquid = "1234564897",
            NECURequestHeader = new
            {
                credential = "aps-exchange-user",
                clientDt = "2020-12-05T00:00:00.00Z"
            },
            consumerChannel = "TP",
            consumingApplicationName = "DEMO",
            accountNumber = "123456789",
            accountType = "IM"
        };

        // Convert the request object to JSON
        var json = JsonSerializer.Serialize(requestData);

        // Set up the HttpClient request
        var requestContent = new StringContent(json, Encoding.UTF8, "application/json");

        try
        {
            // Send the request to the API
            var response = await client.PostAsync(apiUrl, requestContent);

            // Read the response content
            var responseContent = await response.Content.ReadAsStringAsync();

            // Output the raw response
            Console.WriteLine("Raw Response: " + responseContent);

            // Deserialize the JSON response to a C# object
            var responseData = JsonSerializer.Deserialize<ResponseData>(responseContent);

            // Print parsed data
            Console.WriteLine("Status Code: " + responseData.NECUResponseHeader.Status.statusCode);
            Console.WriteLine("Status Message: " + responseData.NECUResponseHeader.Status.statusDesc);
            Console.WriteLine("Account Number: " + responseData.accountNumber);
            Console.WriteLine("Message Text from Notes:");
            foreach (var note in responseData.notes)
            {
                Console.WriteLine("- " + note.messageText);
                Console.WriteLine("  Expire Date: " + note.notesExpireDate);
            }
        }
        catch (Exception ex)
        {
            Console.WriteLine("Error occurred: " + ex.Message);
        }
    }
}
